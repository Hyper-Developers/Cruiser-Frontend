<!DOCTYPE html>
<html>
  <head>
    <title>Loading...</title>
  </head>
  <body>
    <noscript>
      <p>You have JavaScript disabled. This website requires JavaScript to be enabled in order to work.</p>
    </noscript>
    <p>Loading...</p>
    <script>
      // https://stackoverflow.com/a/5448595
      function findGetParameter(parameterName) {
        let result = null,
        let tmp = [];
        location.search.substr(1).split("&").forEach(item => {
          tmp = item.split("=");
          if (tmp[0] === parameterName) result = decodeURIComponent(tmp[1]);
        });
        return result;
      }
      
      let xhr = new XMLHttpRequest();
      xhr.timeout = 2000;
      xhr.open("POST", "https://cruiser.pandapip1.com/authorized", true);
      xhr.setRequestHeader('Content-Type', 'application/json');
      xhr.onreadystatechange = () => {
        if (this.readyState == 4){
          if (Math.floor(this.status / 100) == 2)
            window.location.href = "https://discord.com/oauth2/authorized";
          else 
            window.history.back();
        }
      };
      xhr.onerror = () => window.history.back();
      xhr.send(JSON.stringify({
        code: findGetParameter("code"),
        state: findGetParameter("state")
      }));
    </script>
  </body>
</html>
