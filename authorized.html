<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Loading...</title>
        <link rel="icon" type="image/png" href="img/c1cced9e02b58d277f012b46f99d7e8c.png">
        <meta name="description" content="Cruiser">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="all,follow">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css">
        <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <noscript><style> .jsonly { display: none !important; } </style></noscript>
    </head>
    <body style="background-color: #23272a;" class="h-100">
        <noscript class="w-100 h-100">
            <div class="w-25" style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);">
                <div class="card text-white bg-dark mb-3 w-100">
                    <div class="card-header">Error</div>
                    <div class="card-body">
                        <img src="https://img.icons8.com/ios/500/fa314a/error--v1.png" class="img-fluid mx-auto d-block" style="max-width: 50%;"/>
                        <p class="card-text mb-3 text-center">You have JavaScript disabled. This website requires JavaScript to be enabled in order to work.</p>
                    </div>
                </div>
            </div>
        </noscript>
        <div class="jsonly w-100 h-100">
            <div class="w-25" style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);">
                <div class="card text-white bg-dark mb-3 w-100">
                    <div class="card-header">Loading...</div>
                    <div class="card-body">
                        <img src="https://img.icons8.com/ios-filled/500/4a90e2/loading-sign.png" class="img-fluid mx-auto d-block" style="max-width: 50%;"/>
                    </div>
                </div>
            </div>
        </div>
        <!-- JavaScript -->
        <script defer src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.slim.min.js"></script>
        <script defer src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.bundle.min.js"></script>
        <script defer src="https://cdn.jsdelivr.net/npm/@fingerprintjs/fingerprintjs-pro@3/dist/fp.min.js"></script>
        <script defer>
            (async () => {
                const fp = await FingerprintJS.load({ token: 'wFaPo4fHicVz2L00gt1YNG2l' });
                const fpRes = await fp.get();
                
                // https://stackoverflow.com/a/5448595
                function findGetParameter(parameterName) {
                    let result = null;
                    let tmp = [];
                    window.location.search.substr(1).split("&").forEach(item => {
                        tmp = item.split("=");
                        if (tmp[0] === parameterName) result = decodeURIComponent(tmp[1]);
                    });
                    return result;
                }
                let xhr = new XMLHttpRequest();
                xhr.timeout = 2000;
                xhr.open("POST", "https://cruiser.pandapip1.com/authorized", true);
                xhr.setRequestHeader('Content-Type', 'application/json');
                xhr.onreadystatechange = () => {
                    if (xhr.readyState === 4){
                        if (Math.floor(xhr.status / 100) === 2) {
                            window.location.href = "https://discord.com/oauth2/authorized";
                        } else {
                            window.location.href = "https://hyper-developers.github.io/Cruiser-Frontend/error.html";
                        }
                    }
                };
                xhr.ontimeout = () => { window.location.href = "https://hyper-developers.github.io/Cruiser-Frontend/error.html"; };
                xhr.onerror = () => { window.location.href = "https://hyper-developers.github.io/Cruiser-Frontend/error.html"; };
                xhr.send(JSON.stringify({
                    code: findGetParameter("code"),
                    state: findGetParameter("state"),
                    visitorId: fpRes.visitorId
                }));
            })();
        </script>
    </body>
</html>
